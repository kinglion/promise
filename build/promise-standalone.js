var XPromise=function(){var n;return n=function(n){var t;return t=function(n){function t(n,t){if(n)for(var e=0,r=n.length;r>e&&t(n[e],e)!==!1;e++);}function e(n,t){for(var e in t)n[e]=t[e]}function r(n){return n&&"function"==typeof n.then}function i(n,t,e){if(n instanceof f)e.call(n,n.reason);else if(n instanceof s||!r(n)){var o=n[v];if(r(o)||o instanceof f)return i(o,t,e),void 0;n[p]===w?n[d].push([t,e]):t&&t.call(n,o)}else n.then(t,e)}function o(n){var t=this;return t instanceof o?(t.promise=n||new s,t.promise.defer=t,void 0):new o(n)}function u(n){return n&&n instanceof s}function c(n,t){return function(){return n.apply(t,arguments)}}function s(n){var t=this;if(t[d]=[],t[m]=[],n)if("function"==typeof n){t[p]=w;var e=new o(t),r=c(e.resolve,e),i=c(e.reject,e);try{n(r,i)}catch(u){console.error(u.stack||u),i(u)}}else t[p]=y;else t[p]=w}function f(n){return n instanceof f?n:(this.reason=n,void 0)}function a(n,t,e){function u(n){try{return t?t.call(this,n):n}catch(e){return console.error(e.stack||e),new f(e)}}function c(n){try{return e?e.call(this,n):new f(n)}catch(t){return console.error(t.stack||t),new f(t)}}function s(n){l||(l=1,a.resolve(u.call(this,n)))}var a=new o,l=0;return r(n)?i(n,s,function(n){l||(l=1,a.resolve(c.call(this,n)))}):s(n),a.promise}function l(n){return n&&n[p]===y}function h(n){return n&&n[p]===_}var v="__promise_value",p="__promise_status",m="__promise_progress_listeners",d="__promise_pendings",w="Pending",y="Fulfilled",_="Rejected";return o.prototype={constructor:o,resolve:function(n){var e=this.promise;if(e[p]!==w)return null;e[p]=y,e[v]=n;var r=e[d];return t(r,function(n){i(e,n[0],n[1])}),e[d]=[],e[m]=[],this.promise},reject:function(n){return this.resolve(new f(n)),this.promise[p]=_,this.promise},notify:function(n){return this.promise[p]!==w?null:(t(this.promise[m],function(t){t(n)}),void 0)}},s.prototype={constructor:s,then:function(n,t,e){return e&&this.progress(e),a(this,n,t)},progress:function(n){var t=this,e=t[m];return t[p]!==w?t:(e||(e=t[m]=[]),e.push(n),t)},fail:function(n){return this.then(0,n)},fin:function(n){return this.then(function(t){return n(t,!0)},function(t){return n(t,!1)})},done:function(n,t){var e=this,r=function(n){setTimeout(function(){throw n},0)},i=n||t?e.then(n,t):e;i.fail(r)},isResolved:function(){return l(this)},isRejected:function(){return h(this)}},s.prototype["catch"]=s.prototype.fail,s.Defer=o,e(s,{version:"1.1.0",when:a,cast:function(n){return n instanceof s?n:new s(function(t){t(n)})},resolve:function(n){return new s(function(t){t(n)})},reject:function(n){return new s(function(t,e){e(n)})},isPromise:u,isResolved:l,isRejected:h,all:function(n){var t=n.length;if(!t)return null;for(var e=new o,r=0;r<n.length;r++)!function(r,i){a(r,function(r){n[i]=r,0===--t&&e.resolve(n)},function(n){e.reject(n)})}(n[r],r);return e.promise},async:function(n){return function(){function t(n,t){var o;return o=i[n](t),o.done?o.value:a(o.value,e,r)}function e(n){return t("next",n)}function r(n){return t("throw",n)}var i=n.apply(this,arguments);try{return e()}catch(o){return s.reject(o)}}}}),n=s}(),n=t}()}();